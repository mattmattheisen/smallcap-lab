<script>
  const base = window.location.origin;

  async function toDisplay(res) {
    const ct = (res.headers.get('content-type') || '').toLowerCase();
    if (ct.includes('application/json')) {
      const j = await res.json();
      return JSON.stringify(j, null, 2);
    } else {
      const t = await res.text();
      return t;
    }
  }

  document.getElementById('runScreen').onclick = async () => {
    const q = new URLSearchParams({
      minDollarVol: document.getElementById('minDollarVol').value || "2000000",
      minPrice: document.getElementById('minPrice').value || "3",
      maxDebtToEbitda: document.getElementById('maxDebtToEbitda').value || "2.5",
      minFScore: document.getElementById('minFScore').value || "6",
      minGrossProf: document.getElementById('minGrossProf').value || "0",
      excludeEarningsWindow: document.getElementById('excludeEarningsWindow').value || "true",
      confidence: document.getElementById('confidence').value || "0.7",
    }).toString();
    const url = `${base}/api/screen?${q}`;
    try{
      const res = await fetch(url, { cache: 'no-store' });
      document.getElementById('screenOut').textContent = await toDisplay(res);
    }catch(e){
      document.getElementById('screenOut').textContent = 'Error: ' + e;
    }
  };

  document.getElementById('runSignal').onclick = async () => {
    const q = new URLSearchParams({
      symbol: document.getElementById('symbol').value || "AEIS",
      conf: document.getElementById('conf').value || "0.72",
      mu: document.getElementById('mu').value || "0.018",
      sigma: document.getElementById('sigma').value || "0.07",
      kellyMode: document.getElementById('kellyMode').value || "half",
      maxWeight: document.getElementById('maxWeight').value || "0.07",
    }).toString();
    const url = `${base}/api/signal?${q}`;
    try{
      const res = await fetch(url, { cache: 'no-store' });
      document.getElementById('signalOut').textContent = await toDisplay(res);
    }catch(e){
      document.getElementById('signalOut').textContent = 'Error: ' + e;
    }
  };
</script>
